
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  creationTimestamp: null
  name: canaries.app.alibabacloud.com
spec:
  group: app.alibabacloud.com
  names:
    kind: Canary
    listKind: CanaryList
    plural: canaries
    singular: canary
  scope: ""
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      description: Canary is the configuration for a canary release, which automatically
        manages the bootstrap, analysis, traffic shifting, promotion or rollback of
        an app revision
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation
            of an object. Servers should convert recognized schemas to the latest
            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this
            object represents. Servers may infer this from the endpoint the client
            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: CanarySpec is the specification of the desired behavior of
            the Canary
          properties:
            analysis:
              description: Analysis defines the validation process of a release
              properties:
                alerts:
                  description: Alert list for this canary analysis
                  items:
                    description: CanaryAlert defines an alert for this canary
                    properties:
                      name:
                        description: Name of the alert
                        type: string
                      providerRef:
                        description: Alert provider reference
                        properties:
                          apiVersion:
                            description: API version of the referent
                            type: string
                          kind:
                            description: Kind of the referent
                            type: string
                          name:
                            description: Name of the referent
                            type: string
                          namespace:
                            description: Namespace of the referent
                            type: string
                        required:
                        - name
                        type: object
                      severity:
                        description: 'Severity level: info, warn, error (default info)'
                        type: string
                    required:
                    - name
                    - providerRef
                    type: object
                  type: array
                interval:
                  description: Schedule interval for this canary analysis
                  type: string
                iterations:
                  description: Number of checks to run for A/B Testing and Blue/Green
                  type: integer
                maxWeight:
                  description: Max traffic percentage routed to canary
                  type: integer
                mirror:
                  description: Enable traffic mirroring for Blue/Green
                  type: boolean
                mirrorWeight:
                  description: Percentage of the traffic to be mirrored in the range
                    of [0, 100].
                  type: integer
                stepWeight:
                  description: Incremental traffic percentage step
                  type: integer
                threshold:
                  description: Max number of failed checks before the canary is terminated
                  type: integer
                webhooks:
                  description: Webhook list for this canary  analysis
                  items:
                    description: CanaryWebhook holds the reference to external checks
                      used for canary analysis
                    properties:
                      metadata:
                        additionalProperties:
                          type: string
                        description: Metadata (key-value pairs) for this webhook
                        type: object
                      name:
                        description: Name of this webhook
                        type: string
                      timeout:
                        description: Request timeout for this webhook
                        type: string
                      type:
                        description: Type of this webhook
                        type: string
                      url:
                        description: URL address of this webhook
                        type: string
                    required:
                    - name
                    - type
                    - url
                    type: object
                  type: array
              required:
              - interval
              - threshold
              type: object
            autoscalerRef:
              description: AutoscalerRef references an autoscaling resource
              properties:
                apiVersion:
                  description: API version of the referent
                  type: string
                kind:
                  description: Kind of the referent
                  type: string
                name:
                  description: Name of the referent
                  type: string
                namespace:
                  description: Namespace of the referent
                  type: string
              required:
              - name
              type: object
            ingressRef:
              description: Reference to NGINX ingress resource
              properties:
                apiVersion:
                  description: API version of the referent
                  type: string
                kind:
                  description: Kind of the referent
                  type: string
                name:
                  description: Name of the referent
                  type: string
                namespace:
                  description: Namespace of the referent
                  type: string
              required:
              - name
              type: object
            progressDeadlineSeconds:
              description: ProgressDeadlineSeconds represents the maximum time in
                seconds for a canary deployment to make progress before it is considered
                to be failed
              format: int32
              type: integer
            provider:
              description: Provider overwrites the -mesh-provider flag for this particular
                canary
              type: string
            revertOnDeletion:
              description: revert canary mutation on deletion of canary resource
              type: boolean
            service:
              description: Service defines how ClusterIP services, service mesh or
                ingress routing objects are generated
              properties:
                backends:
                  description: Backends of the generated App Mesh virtual nodes
                  items:
                    type: string
                  type: array
                gateways:
                  description: Gateways attached to the generated Istio virtual service
                    Defaults to the internal mesh gateway
                  items:
                    type: string
                  type: array
                hosts:
                  description: Hosts attached to the generated Istio virtual service
                    Defaults to the service name
                  items:
                    type: string
                  type: array
                meshName:
                  description: Mesh name of the generated App Mesh virtual nodes and
                    virtual service
                  type: string
                name:
                  description: Name of the Kubernetes service generated by Flagger
                    Defaults to CanarySpec.TargetRef.Name
                  type: string
                port:
                  description: Port of the generated Kubernetes service
                  format: int32
                  type: integer
                portDiscovery:
                  description: PortDiscovery adds all container ports to the generated
                    Kubernetes service
                  type: boolean
                portName:
                  description: Port name of the generated Kubernetes service Defaults
                    to http
                  type: string
                targetPort:
                  anyOf:
                  - type: string
                  - type: integer
                  description: Target port number or name of the generated Kubernetes
                    service Defaults to CanaryService.Port
                timeout:
                  description: Timeout of the HTTP or gRPC request
                  type: string
              required:
              - port
              type: object
            skipAnalysis:
              description: SkipAnalysis promotes the canary without analysing it
              type: boolean
            targetRef:
              description: TargetRef references a target resource
              properties:
                apiVersion:
                  description: API version of the referent
                  type: string
                kind:
                  description: Kind of the referent
                  type: string
                name:
                  description: Name of the referent
                  type: string
                namespace:
                  description: Namespace of the referent
                  type: string
              required:
              - name
              type: object
          required:
          - service
          - targetRef
          type: object
        status:
          description: CanaryStatus is used for state persistence (read-only)
          properties:
            canaryWeight:
              type: integer
            conditions:
              items:
                description: CanaryCondition is a status condition for a Canary
                properties:
                  lastTransitionTime:
                    description: LastTransitionTime of this condition
                    format: date-time
                    type: string
                  lastUpdateTime:
                    description: LastUpdateTime of this condition
                    format: date-time
                    type: string
                  message:
                    description: Message associated with this condition
                    type: string
                  reason:
                    description: Reason for the current status of this condition
                    type: string
                  status:
                    description: Status of this condition
                    type: string
                  type:
                    description: Type of this condition
                    type: string
                required:
                - status
                - type
                type: object
              type: array
            failedChecks:
              type: integer
            iterations:
              type: integer
            lastAppliedSpec:
              type: string
            lastPromotedSpec:
              type: string
            lastTransitionTime:
              format: date-time
              type: string
            phase:
              description: CanaryPhase is a label for the condition of a canary at
                the current time
              type: string
            trackedConfigs:
              additionalProperties:
                type: string
              type: object
          required:
          - canaryWeight
          - failedChecks
          - iterations
          - phase
          type: object
      required:
      - spec
      type: object
  version: v1beta1
  versions:
  - name: v1beta1
    served: true
    storage: true
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
